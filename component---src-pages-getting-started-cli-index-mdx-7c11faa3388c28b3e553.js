(window.webpackJsonp=window.webpackJsonp||[]).push([[38],{BAC9:function(e,t,n){e.exports={bxTextTruncateEnd:"EditLink-module--bx--text-truncate--end--2pqje",bxTextTruncateFront:"EditLink-module--bx--text-truncate--front--3_lIE",link:"EditLink-module--link--1qzW3",row:"EditLink-module--row--1B9Gk"}},I8xM:function(e,t,n){e.exports={bxTextTruncateEnd:"PageTabs-module--bx--text-truncate--end--267NA",bxTextTruncateFront:"PageTabs-module--bx--text-truncate--front--3xEQF",tabsContainer:"PageTabs-module--tabs-container--8N4k0",list:"PageTabs-module--list--3eFQc",listItem:"PageTabs-module--list-item--nUmtD",link:"PageTabs-module--link--1mDJ1",selectedItem:"PageTabs-module--selected-item--YPVr3"}},QH2O:function(e,t,n){e.exports={bxTextTruncateEnd:"PageHeader-module--bx--text-truncate--end--mZWeX",bxTextTruncateFront:"PageHeader-module--bx--text-truncate--front--3zvrI",pageHeader:"PageHeader-module--page-header--3hIan",darkMode:"PageHeader-module--dark-mode--hBrwL",withTabs:"PageHeader-module--with-tabs--3nKxA",text:"PageHeader-module--text--o9LFq"}},RcCX:function(e,t,n){"use strict";n.r(t),n.d(t,"_frontmatter",(function(){return c})),n.d(t,"default",(function(){return j}));var a=n("wx14"),l=n("zLVn"),i=(n("q1tI"),n("7ljp")),r=n("XbGe"),o=n("T0C+"),c=(n("qKvR"),{}),p=function(e){return function(t){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),Object(i.b)("div",t)}},s=p("PageDescription"),b=p("Accordion"),m=p("AccordionItem"),d=p("InlineNotification"),h=p("Tabs"),u=p("Tab"),g={_frontmatter:c},O=r.a;function j(e){var t=e.components,n=Object(l.a)(e,["components"]);return Object(i.b)(O,Object(a.a)({},g,n,{components:t,mdxType:"MDXLayout"}),Object(i.b)(s,{mdxType:"PageDescription"},Object(i.b)("p",null,"The ",Object(i.b)(o.a,{name:"shortName",mdxType:"Globals"})," Command Line Interface (CLI)")),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"TLDR; Install the CLI")),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-shell",metastring:"script",script:!0},"npm i -g @ibmgaragecloud/cloud-native-toolkit-cli\n")),Object(i.b)("p",null,"The ",Object(i.b)(o.a,{name:"longName",mdxType:"Globals"})," includes the IBM Garage for Cloud (IGC) Command Line Interface (CLI).\nThe ",Object(i.b)("a",{parentName:"p",href:"https://github.com/cloud-native-toolkit/ibm-garage-cloud-cli"},Object(i.b)(o.a,{name:"igccli",mdxType:"Globals"}))," provides a set of helpful\nutilities that can be invoked from the command line. It was created to automate and simplify complicated and repetitive\ntasks, allowing developers to be more productive."),Object(i.b)("p",null,"Use of the CLI is in no way required to work with the ",Object(i.b)(o.a,{name:"shortName",mdxType:"Globals"})," and everything done by the CLI can\nbe done manually instead. For each of the commands, the equivalent manual steps are also given for the sake of full\ntransparency and to take away any notion of “magic” that the CLI might be performing."),Object(i.b)("p",null,"Some of the utilities provided by the CLI include:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Register your application’s git repo into a CI pipeline (",Object(i.b)("a",{parentName:"li",href:"/tools/jenkins"},"Jenkins"),", ",Object(i.b)("a",{parentName:"li",href:"/tools/tekton/"},"Tekton"),", etc.)"),Object(i.b)("li",{parentName:"ul"},"List the ingress URLs and route URLs defined within the cluster"),Object(i.b)("li",{parentName:"ul"},"List the connection information (endpoints, user names, and passwords) for the tools configured in the environment"),Object(i.b)("li",{parentName:"ul"},"Help copy ",Object(i.b)("inlineCode",{parentName:"li"},"config maps")," and ",Object(i.b)("inlineCode",{parentName:"li"},"secrets")," into new projects/namespace"),Object(i.b)("li",{parentName:"ul"},"Enable existing ",Object(i.b)(o.a,{name:"templates",mdxType:"Globals"})," with the necessary artifacts to be integrated easily into the ",Object(i.b)(o.a,{name:"env",mdxType:"Globals"}))),Object(i.b)("p",null,"You can either install the CLI onto your computer or install the Cloud Shell Commands environment."),Object(i.b)(b,{mdxType:"Accordion"},Object(i.b)(m,{title:"Install the CLI",open:"true",mdxType:"AccordionItem"},Object(i.b)(d,{kind:"warning",mdxType:"InlineNotification"},Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Warning:")," If you receive an ",Object(i.b)("inlineCode",{parentName:"p"},"EACCES")," error when you try to install the cli using the instructions that follow, it is an indiction that\nnpm cannot write to the global package directory and that node has not been set up properly on your machine. ",Object(i.b)("strong",{parentName:"p"},"DO NOT"),"\nrerun the command with ",Object(i.b)("inlineCode",{parentName:"p"},"sudo"),". (Here’s an overview of why that’s a bad idea - ",Object(i.b)("a",{parentName:"p",href:"https://medium.com/@ExplosionPills/dont-use-sudo-with-npm-still-66e609f5f92"},"Don’t use sudo with npm")," )"),Object(i.b)("p",null,"Instead, you need to correct the issue with node. There are two options:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"To fix your current installation, follow ",Object(i.b)("a",{parentName:"li",href:"http://npm.github.io/installation-setup-docs/installing/a-note-on-permissions.html"},"these instructions")),Object(i.b)("li",{parentName:"ul"},"To install using Node Version Manager, follow ",Object(i.b)("a",{parentName:"li",href:"https://github.com/nvm-sh/nvm#installing-and-updating"},"these instructions"))),Object(i.b)("p",null,"Once npm has been updated, rerun the command to install the cli.")),Object(i.b)("br",null),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},"Install the CLI:"),Object(i.b)("pre",{parentName:"li"},Object(i.b)("code",{parentName:"pre",className:"language-shell"},"npm i -g @ibmgaragecloud/cloud-native-toolkit-cli\n"))),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},"Verify the version:"),Object(i.b)("pre",{parentName:"li"},Object(i.b)("code",{parentName:"pre",className:"language-shell"},"igc --version\n")))),Object(i.b)("p",null,Object(i.b)("em",{parentName:"p"},"Note:")," If you are adventurous, you can install the beta version of the cli that contains upcoming features with the\nfollowing command (switch back at any time with the above command):"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-shell"},"npm i -g @ibmgaragecloud/cloud-native-toolkit-cli@beta\n"))),Object(i.b)(m,{title:"Install the Cloud Shell",mdxType:"AccordionItem"},Object(i.b)("p",null,"Follow the instructions in the ",Object(i.b)("a",{parentName:"p",href:"/getting-started/dev-env-setup"},"development environment setup")," to install the shell commands."))),Object(i.b)("h2",null,"Invoking the CLI"),Object(i.b)("p",null,"When the CLI is installed, it adds an executable named ",Object(i.b)("inlineCode",{parentName:"p"},"igc")," to the PATH. Running ",Object(i.b)("inlineCode",{parentName:"p"},"igc --help")," will list\nthe available commands. The output text will be similar to the following:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-shell",metastring:"script",script:!0},"$ igc --help\nIBM Garage Cloud Native Toolkit CLI (https://cloudnativetoolkit.dev)\n\nUsage: igc <command> [args]\n\nCommands:\n  igc console                  Launch the IKS or OpenShift admin console\n  igc create-webhook           Create a git webhook for a given Jenkins pipeline\n  igc credentials              Lists the urls and credentials for the tools\n                               deployed to the cluster\n  igc dashboard                Open the Developer Dashboard in the default\n                               browser\n  igc enable                   Enable the current repository with pipeline logic\n  igc endpoints                List the current ingress hosts for deployed apps\n                               in a namespace\n                                         [aliases: ingress, endpoint, ingresses]\n  igc git-secret [name]        Create a kubernetes secret that contains the url,\n                               username, and personal access token for a git\n                               repo\n  igc git [remote]             Launches a browser to the git repo url specified\n                               by the remote. If not provided remote defaults to\n                               origin\n  igc gitops                   Registers the git repository in the kubernetes\n                               cluster as the gitops repository for the given\n                               namespace\n  igc sync [namespace]         Create a namespace (if it does not exist) and\n                               prepare it with the necessary configuration\n                                                   [aliases: project, namespace]\n  igc pull-secret [namespace]  Copy pull secrets into the provided project from\n                               the template namespace\n  igc pipeline [gitUrl]        Register a pipeline for the current code\n                               repository\n  igc tool-config [name]       Create the config map and secret for a tool\n                               configured in the environment\n  igc vlan                     Print out the vlan values\n  igc yq <command>             lightweight yaml command-line processor that\n                               addresses deficiencies with the existing `yq`\n                               command\n\nOptions:\n  --version  Show version number                                       [boolean]\n  --help     Show help                                                 [boolean]\n")),Object(i.b)("p",null,"As of v0.5.1, the ",Object(i.b)(o.a,{name:"igccli",mdxType:"Globals"})," will now install the commands as plugins to the ",Object(i.b)("inlineCode",{parentName:"p"},"kubectl")," and ",Object(i.b)("inlineCode",{parentName:"p"},"oc")," CLIs.\nFor example, all of the following are equivalent:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-shell",metastring:"script",script:!0},"igc pipeline\nkubectl pipeline\noc pipeline\n")),Object(i.b)("h3",null,"Prerequisite tools"),Object(i.b)(d,{mdxType:"InlineNotification"},Object(i.b)("p",null,"Some of the commands provided by the ",Object(i.b)(o.a,{name:"igccli",mdxType:"Globals"})," orchestrate interactions between other CLIs. To get\nstarted please install the ",Object(i.b)("a",{parentName:"p",href:"/getting-started/prereqs"},"prerequisite tools"),", in particular:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"The ",Object(i.b)(o.a,{name:"kube",mdxType:"Globals"})," CLI"),Object(i.b)("li",{parentName:"ul"},"The ",Object(i.b)(o.a,{name:"ocp",mdxType:"Globals"})," CLI"),Object(i.b)("li",{parentName:"ul"},"The ",Object(i.b)(o.a,{name:"ic",mdxType:"Globals"})," CLI - used to interact with IBM Cloud vlans (not needed if tools will not run on IBM Cloud)"))),Object(i.b)("h3",null,"Log into your cluster"),Object(i.b)("p",null,"Most all of the commands provided by the ",Object(i.b)(o.a,{name:"igccli",mdxType:"Globals"})," interact with a cluster. It probably comes as no\nsurprise then that you should be logged into the prior to running the commands."),Object(i.b)(b,{mdxType:"Accordion"},Object(i.b)(m,{title:"OpenShift",open:"true",mdxType:"AccordionItem"},Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-shell",metastring:"script",script:!0},"oc login --server=<url> --token=<apikey>\n"))),Object(i.b)(m,{title:"Kubernetes",mdxType:"AccordionItem"},Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-shell",metastring:"script",script:!0},"ibmcloud ks cluster config --cluster <CLUSTER>\n")))),Object(i.b)("h3",null,"Log into your IBM Cloud account"),Object(i.b)("p",null,"The ",Object(i.b)("inlineCode",{parentName:"p"},"vlan")," command provided by the ",Object(i.b)(o.a,{name:"igccli",mdxType:"Globals"})," interacts with your IBM Cloud account to\nget the VLAN information needed to create a cluster. The command assumes you have already logged into\nyour account prior to running the command."),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},"Log into your ",Object(i.b)(o.a,{name:"ic",mdxType:"Globals"})," account with the correct region and resource group:"),Object(i.b)("pre",{parentName:"li"},Object(i.b)("code",{parentName:"pre",className:"language-shell",metastring:"script",script:!0},"ibmcloud login -a cloud.ibm.com -r <region> -g <resource group>\n")))),Object(i.b)("h2",null,"Available commands"),Object(i.b)("h3",null,"dashboard"),Object(i.b)("p",null,"Opens the ",Object(i.b)("a",{parentName:"p",href:"/getting-started-day-1/dashboard/"},"Developer Dashboard")," in the default browser. If a default browser has not been\nconfigured, then the URL to the Dashboard will be printed out."),Object(i.b)("p",null,"The dashboard displays the ",Object(i.b)(o.a,{name:"shortName",mdxType:"Globals"})," tools configured within the cluster along with links to\nactivation content and links to Starter Kits to start a project quickly."),Object(i.b)("p",null,"This command requires that the login context for the cluster has already been established."),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Command flags")),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"-n"),": the namespace where the dashboard has been deployed; the default is ",Object(i.b)("inlineCode",{parentName:"li"},"tools"))),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Usage")),Object(i.b)(h,{mdxType:"Tabs"},Object(i.b)(u,{label:"CLI",mdxType:"Tab"},Object(i.b)("p",null,"The command is used in the following way:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-shell",metastring:"script",script:!0},"igc dashboard\n"))),Object(i.b)(u,{label:"OpenShift",mdxType:"Tab"},Object(i.b)("p",null,"The following commands would have the same result on OpenShift:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-shell",metastring:"script",script:!0},"HOST=$(oc get routes/dashboard -n tools -o jsonpath='{.spec.host}')\nopen \"https://$HOST\"\n"))),Object(i.b)(u,{label:"Kubernetes",mdxType:"Tab"},Object(i.b)("p",null,"The following commands would have the same result on Kubernetes:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-shell",metastring:"script",script:!0},"HOST=$(kubectl get ingress/developer-dashboard -n tools -o jsonpath='{.spec.rules[0].host}')\nopen \"https://$HOST\"\n")))),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Related commands")),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",{parentName:"li",href:"#credentials"},"credentials"),": shows information about the same tools shown in the dashboard from the\ncommand-line"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",{parentName:"li",href:"#tool-config"},"tool-config"),": allows configuration for additional tools to be added to the cluster, making them\navailable to the dashboard and ",Object(i.b)("inlineCode",{parentName:"li"},"credentials")," command")),Object(i.b)("h3",null,"console"),Object(i.b)("p",null,"Opens the ",Object(i.b)("em",{parentName:"p"},"IKS or OpenShift admin console")," in the default browser. If a default browser has not been\nconfigured, then the URL to the console will be printed out."),Object(i.b)("p",null,"This command requires that the login context for the cluster has already been established."),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Usage")),Object(i.b)(h,{mdxType:"Tabs"},Object(i.b)(u,{label:"CLI",mdxType:"Tab"},Object(i.b)("p",null,"The command is used in the following way:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-shell",metastring:"script",script:!0},"igc console\n"))),Object(i.b)(u,{label:"OpenShift",mdxType:"Tab"},Object(i.b)("p",null,"The following commands would have the same result on OpenShift:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-shell",metastring:"script",script:!0},"open $(oc whoami --show-console)\n"))),Object(i.b)(u,{label:"Kubernetes",mdxType:"Tab"},Object(i.b)("p",null,"The following commands would have the same result on Kubernetes:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-shell",metastring:"script",script:!0},'REGION="..."\nCLUSTER_NAME="..."\nCLUSTER_ID=$(ibmcloud ks cluster get --cluster ${CLUSTER_NAME} | grep -E "^ID" | sed -E "s/ID: +([^ ]+)/\\\\1/g")\nopen "https://${REGION}.containers.cloud.ibm.com/kubeproxy/clusters/${CLUSTER_ID}/service/#/overview?namespace=default"\n')))),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Related commands")),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",{parentName:"li",href:"#credentials"},"credentials"),": shows information about the same tools shown in the dashboard from the\ncommand-line"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",{parentName:"li",href:"#tool-config"},"tool-config"),": allows configuration for additional tools to be added to the cluster, making them\navailable to the dashboard and ",Object(i.b)("inlineCode",{parentName:"li"},"credentials")," command")),Object(i.b)("h3",null,"git"),Object(i.b)("p",null,"Opens the Git repo in the default browser for the current working directory. If a default browser has not been\nconfigured, then the URL to the repo will be printed out."),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Usage")),Object(i.b)(h,{mdxType:"Tabs"},Object(i.b)(u,{label:"CLI",mdxType:"Tab"},Object(i.b)("p",null,"The command is used in the following way:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-shell",metastring:"script",script:!0},"igc git\n")),Object(i.b)("p",null,"If you have multiple remotes and would like to open one other than ",Object(i.b)("inlineCode",{parentName:"p"},"origin"),":"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-shell",metastring:"script",script:!0},"igc git origin-fork\n"))),Object(i.b)(u,{label:"Manual",mdxType:"Tab"},Object(i.b)("p",null,"The following commands would have the same result with shell commands:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-shell",metastring:"script",script:!0},"alias gh=\"open https://github.$(git config remote.origin.url | cut -f2 -d. | tr ':' /)\"\n")))),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Related commands")),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",{parentName:"li",href:"#credentials"},"credentials"),": shows information about the same tools shown in the dashboard from the\ncommand-line"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",{parentName:"li",href:"#tool-config"},"tool-config"),": allows configuration for additional tools to be added to the cluster, making them\navailable to the dashboard and ",Object(i.b)("inlineCode",{parentName:"li"},"credentials")," command")),Object(i.b)("h3",null,"credentials"),Object(i.b)("p",null,"Lists the endpoints, user names, and passwords for the tools configured in the environment. This is the easiest way to\nget the login credentials for each of the installed tools. Ideally all of the tools would be accessible via SSO at which\npoint this command will be obsolete."),Object(i.b)("p",null,"The command works by reading information available in the cluster. When each tool is installed by the toolkit, a\n",Object(i.b)("inlineCode",{parentName:"p"},"config map")," and ",Object(i.b)("inlineCode",{parentName:"p"},"secret")," are created to store the url and credential for the tool. That information is used in a\nnumber of different ways within the environment:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Provide configuration information to the pipelines"),Object(i.b)("li",{parentName:"ul"},"Populate the tiles on the ",Object(i.b)("a",{parentName:"li",href:"/getting-started-day-1/dashboard/"},"Developer Dashboard")),Object(i.b)("li",{parentName:"ul"},"Populate the results of the ",Object(i.b)("inlineCode",{parentName:"li"},"credentials")," command")),Object(i.b)("p",null,"This command requires that the login context for the cluster has already been established."),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Command flags")),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"-n"),": the namespace where the tools have been deployed; the default is ",Object(i.b)("inlineCode",{parentName:"li"},"tools"))),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Usage")),Object(i.b)(h,{mdxType:"Tabs"},Object(i.b)(u,{label:"CLI",mdxType:"Tab"},Object(i.b)("p",null,"The command is used in the following way:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-shell",metastring:"script",script:!0},"igc credentials\n")),Object(i.b)("p",null,"The credential output is JSON format like this"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-shell",metastring:"script",script:!0},"Credentials:  {\n  argocd: {\n    user: 'admin',\n    password: '12345678',\n    url: 'https://argocd-tools.mycluster.us-east.containers.appdomain.cloud'\n  },\n  . . .\n  dashboard: {\n    url: 'https://dashboard-tools.mycluster.us-east.containers.appdomain.cloud'\n  },\n  . . .\n}\n"))),Object(i.b)(u,{label:"OpenShift or Kubernetes",mdxType:"Tab"},Object(i.b)("p",null,"The following commands have the same result (note the dependency on ",Object(i.b)("inlineCode",{parentName:"p"},"jq"),"):"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-shell",metastring:"script",script:!0},"# config maps\nkubectl get configmap -n tools -l grouping=garage-cloud-native-toolkit -o json | \\\n  jq '[.items[] | select(.metadata.name != \"ibmcloud-config\").data]'\n\n# secrets\nkubectl get secret -n tools -l grouping=garage-cloud-native-toolkit -o json | \\\n  jq '[.items[] | select(.metadata.name != \"ibmcloud-apikey\").data | with_entries(.value |= @base64d)]'\n")))),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Related commands")),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",{parentName:"li",href:"#dashboard"},"dashboard"),": displays the url of the Developer Dashboard and launches the default browser"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",{parentName:"li",href:"#tool-config"},"tool-config"),": allows configuration for additional tools to be added to the cluster, making them\navailable to the dashboard and ",Object(i.b)("inlineCode",{parentName:"li"},"credentials")," command")),Object(i.b)("h3",null,"endpoints"),Object(i.b)("p",null,"Lists the ingress and/or route URLs for the applications in a given namespace. An attempt will be made to get the\nnamespace from the current context if one is not provided as an argument. Results of the command are provided in an\ninteractive menu. If one of the endpoints is selected, it will display the URL and launch it in the default browser.\nSelecting ",Object(i.b)("inlineCode",{parentName:"p"},"Exit")," will print the full list of endpoints and exit."),Object(i.b)("p",null,"This command requires that the login context for the cluster has already been established."),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Command flags")),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"-n"),": the namespace from which the endpoints will be read; the value will be read from the current context if not\nprovided")),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Usage")),Object(i.b)(h,{mdxType:"Tabs"},Object(i.b)(u,{label:"CLI",mdxType:"Tab"},Object(i.b)("p",null,"The command is used in the following way:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-shell",metastring:"script",script:!0},"igc endpoints\n"))),Object(i.b)(u,{label:"OpenShift",mdxType:"Tab"},Object(i.b)("p",null,"The following commands list the route and ingress endpoints:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-shell",metastring:"script",script:!0},"# routes\nkubectl get route -n tools\n\n# ingress\nkubectl get ingress -n tools\n"))),Object(i.b)(u,{label:"Kubernetes",mdxType:"Tab"},Object(i.b)("p",null,"The following commands list the ingress endpoints:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-shell",metastring:"script",script:!0},"kubectl get ingress -n tools\n")))),Object(i.b)("h3",null,"sync"),Object(i.b)("p",null,"Creates a Kubernetes namespace or OpenShift project (if it doesn’t already exist) and sets it up so that the namespace\ncan be used as a target for application deployments and/or to host the ",Object(i.b)(o.a,{name:"env",mdxType:"Globals"}),"."),Object(i.b)("p",null,"The command synchronize the ",Object(i.b)("inlineCode",{parentName:"p"},"ConfigMaps")," and ",Object(i.b)("inlineCode",{parentName:"p"},"Secrets")," from a template namespace (ie ",Object(i.b)("inlineCode",{parentName:"p"},"tools"),") to create a “development” namespace. After\nthe command has run successfully it will set the provided namespace in the current context\n(e.g. equivalent to ",Object(i.b)("inlineCode",{parentName:"p"},"oc project X"),")"),Object(i.b)("p",null,"This command copies the relevant ",Object(i.b)("inlineCode",{parentName:"p"},"ConfigMaps")," and ",Object(i.b)("inlineCode",{parentName:"p"},"Secrets")," into the namespace that are\nneeded for development activities. Managing resources across namespaces (particularly ",Object(i.b)("inlineCode",{parentName:"p"},"ConfigMaps")," and ",Object(i.b)("inlineCode",{parentName:"p"},"Secrets"),") is a\ncommon challenge in Kubernetes environments. We have provided the command at this time to simplify the steps required\nto get everything ready. Ultimately, this problem seems like an ideal one for an Operator to solve and when one is\navailable (either from the Toolkit or elsewhere) this command will be retired or transitioned."),Object(i.b)("p",null,"The command will setup the “development” namespace where DevOps pipelines can be run (e.g. myapp-dev)"),Object(i.b)("p",null,"The “development” namespace will have the ",Object(i.b)("inlineCode",{parentName:"p"},"ConfigMaps")," and ",Object(i.b)("inlineCode",{parentName:"p"},"Secrets")," copied over."),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre"},'Positionals:\n  namespace  The namespace that will be created and/or prepared\n\nOptions:\n      --version            Show version number                         [boolean]\n      --help               Show help                                   [boolean]\n  -t, --templateNamespace  the template namespace that will be the source of the\n                           config                    [string] [default: "tools"]\n  -z, --serviceAccount     the service account that will be used within the\n                           namespace               [string] [default: "default"]\n      --verbose            flag to produce more verbose logging        [boolean]\n')),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Usage")),Object(i.b)(h,{mdxType:"Tabs"},Object(i.b)(u,{label:"CLI",mdxType:"Tab"},Object(i.b)("p",null,"Create a ",Object(i.b)("inlineCode",{parentName:"p"},"dev")," namespace for development"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-shell",metastring:"script",script:!0},"igc sync myapp-dev\n"))),Object(i.b)(u,{label:"OpenShift",mdxType:"Tab"},Object(i.b)("p",null,"Create a ",Object(i.b)("inlineCode",{parentName:"p"},"dev")," namespace for development"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-shell",metastring:"script",script:!0},"oc sync myapp-dev\n"))),Object(i.b)(u,{label:"Kubernetes",mdxType:"Tab"},Object(i.b)("p",null,"Create a ",Object(i.b)("inlineCode",{parentName:"p"},"dev")," namespace for development"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-shell",metastring:"script",script:!0},"kubectl sync myapp-dev\n"))),Object(i.b)(u,{label:"Manual ConfigMap and Secret setup",mdxType:"Tab"},Object(i.b)("p",null,"The following steps will copy the ",Object(i.b)("inlineCode",{parentName:"p"},"ConfigMaps")," and ",Object(i.b)("inlineCode",{parentName:"p"},"Secrets")," from a template namespace to a target namespace:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-shell",metastring:"script",script:!0},'  export TEMPLATE_NAMESPACE="tools"\n  export NAMESPACE="NAMESPACE"\n\n  kubectl get configmap -l group=catalyst-tools -n ${TEMPLATE_NAMESPACE} -o jsonpath=\'{ range .items[*] }{ .metadata.name }{ "\\n" }{ end }\' | \\\n    while read cm; do\n      kubectl get configmap ${cm} --namespace ${TEMPLATE_NAMESPACE} --export -o yaml | \\\n        kubectl apply --namespace $NAMESPACE -f -\n    done\n\n  kubectl get secret -l group=catalyst-tools -n ${TEMPLATE_NAMESPACE} -o jsonpath=\'{ range .items[*] }{ .metadata.name }{ "\\n" }{ end }\' | \\\n    while read cm; do\n      kubectl get secret ${cm} --namespace ${TEMPLATE_NAMESPACE} --export -o yaml | \\\n        kubectl apply --namespace $NAMESPACE -f -\n    done\n\n')))),Object(i.b)("h3",null,"pull-secret"),Object(i.b)("p",null,"Copy pull secrets into the provided project from the template namespace for the IBM Container Registry."),Object(i.b)("p",null,"Set up a service account in the namespace with the pull secret(s) for the IBM Container Registry that are copied."),Object(i.b)("p",null,"The pull secret(s) are required in order for pods to pull images that are stored in the IBM Container Registry.\nWhen the cluster is created in IBM Cloud, a pull secret is provided in the ",Object(i.b)("inlineCode",{parentName:"p"},"default")," namespace. In order for a\npod in another namespace to use it, the secret must first be copied into the namespace. After that, the pod either\nneeds to reference the pull secret directly or the service account used by the resource needs to have a reference to\nthe secret. The CLI copies the pull secret over and adds it to the service account so the pod can take either\napproach."),Object(i.b)("p",null,"This command should be use to set up “release” namespaces where applications can be deployed (e.g. test, staging)"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre"},'Positionals:\n  namespace  The namespace into which the pull-secret(s) will be created\n\nOptions:\n      --version            Show version number                         [boolean]\n      --help               Show help                                   [boolean]\n  -t, --templateNamespace  the template namespace that will be the source of the\n                           config                    [string] [default: "tools"]\n  -z, --serviceAccount     the service account that will be used within the\n                           namespace               [string] [default: "default"]\n      --dev                flag to indicate this is a development namespace and\n                           that development artifacts should be created[boolean]\n      --verbose            flag to produce more verbose logging        [boolean]\n')),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Usage")),Object(i.b)(h,{mdxType:"Tabs"},Object(i.b)(u,{label:"CLI",mdxType:"Tab"},Object(i.b)("p",null,"Copy the pull secret from ",Object(i.b)("inlineCode",{parentName:"p"},"default")," namespace into ",Object(i.b)("inlineCode",{parentName:"p"},"myapp-test")," namepsace and add to serviceAccount ",Object(i.b)("inlineCode",{parentName:"p"},"default")),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-shell",metastring:"script",script:!0},"igc pull-secret myapp-test -t default -z default\n"))),Object(i.b)(u,{label:"Manual pull secret setup",mdxType:"Tab"},Object(i.b)("p",null,"The following commands will copy the pull secret(s) from the ",Object(i.b)("inlineCode",{parentName:"p"},"default")," namespace and add them to the service account:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-shell",metastring:"script",script:!0},'export NAMESPACE="myapp-test"\nexport SERVICE_ACCOUNT="default"\n\nif [[ $(kubectl get secrets -n "${NAMESPACE}" -o jsonpath=\'{ range .items[*] }{ .metadata.name }{ "\\n" }{ end }\' | grep icr | wc -l | xargs) -eq 0 ]]; then\n    echo "*** Copying pull secrets from default namespace to ${NAMESPACE} namespace"\n\n    kubectl get secrets -n default | grep icr | sed "s/\\([A-Za-z-]*\\) *.*/\\1/g" | while read default_secret; do\n        kubectl get secret ${default_secret} -n default -o yaml --export | sed "s/name: default-/name: /g" | kubectl -n ${NAMESPACE} create -f -\n    done\nelse\n    echo "*** Pull secrets already exist on ${NAMESPACE} namespace"\nfi\n\n\nEXISTING_SECRETS=$(kubectl get serviceaccount/${SERVICE_ACCOUNT} -n "${NAMESPACE}" -o json  | tr \'\\n\' \' \' | sed -E "s/.*imagePullSecrets.: \\[([^]]*)\\].*/\\1/g" | grep icr | wc -l | xargs)\nif [[ ${EXISTING_SECRETS} -eq 0 ]]; then\n    echo "*** Adding secrets to serviceaccount/${SERVICE_ACCOUNT} in ${NAMESPACE} namespace"\n\n    PULL_SECRETS=$(kubectl get secrets -n "${NAMESPACE}" -o jsonpath=\'{ range .items[*] }{ "{\\"name\\": \\""}{ .metadata.name }{ "\\"}\\n" }{ end }\' | grep icr | grep -v "${NAMESPACE}" | paste -sd "," -)\n    kubectl patch -n "${NAMESPACE}" serviceaccount/${SERVICE_ACCOUNT} -p "{\\"imagePullSecrets\\": [${PULL_SECRETS}]}"\nelse\n    echo "*** Pull secrets already applied to serviceaccount/${SERVICE_ACCOUNT} in ${NAMESPACE} namespace"\nfi\n')))),Object(i.b)("h3",null,"pipeline"),Object(i.b)("p",null,"Connects a branch in a Git repo to a either a Jenkins or Tekton CI pipeline in the ",Object(i.b)(o.a,{name:"env",mdxType:"Globals"})," and triggers\nan initial build. A webhook is also created so that when a new commit is added to the branch, the pipeline is triggered\nto start the process to rebuild and redeploy the app using the new code. Currently, webhook creation is supported for\nrepositories hosted on Gitlab, Github, Github Enterprise, Bitbucket, and Gogs."),Object(i.b)("p",null,"This command can either be used to register a git repository that has previously been cloned to the local filesystem ",Object(i.b)("strong",{parentName:"p"},"OR"),"\nusing the remote repo url."),Object(i.b)("h4",null,"Repository location"),Object(i.b)("p",null,"The ",Object(i.b)("inlineCode",{parentName:"p"},"pipeline")," command supports registering a CI pipeline for a repository that has been cloned locally or using the\nremote repository url."),Object(i.b)("h5",null,"Local repository"),Object(i.b)("p",null,"If you are registering a local repository then you must run the command from within the directory of your local clone of the Git repo. When\nregistering a local repository, the pipeline will use the branch that is currently checked out."),Object(i.b)("h5",null,"Remote repository"),Object(i.b)("p",null,"To register a remote repository, pass the repo url as an argument to the ",Object(i.b)("inlineCode",{parentName:"p"},"pipeline"),"\ncommand. For example:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-shell"},'oc pipeline "https://github.com/my-org/my-repo"\n')),Object(i.b)("p",null,"You can optionally provide the branch name with the url using a hash (",Object(i.b)("inlineCode",{parentName:"p"},"#"),"):"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-shell"},'oc pipeline "https://github.com/my-org/my-repo#my-branch"\n')),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Note:")," When registering a remote git repo, if the branch is not provided then the default branch will be used."),Object(i.b)("h4",null,"Pipeline type"),Object(i.b)("p",null,"The ",Object(i.b)("inlineCode",{parentName:"p"},"pipeline")," command supports registering pipelines with either Tekton or Jenkins. The pipeline can be specified from\nthe command-line with either the ",Object(i.b)("inlineCode",{parentName:"p"},"--tekton")," or ",Object(i.b)("inlineCode",{parentName:"p"},"--jenkins")," flags. If a flag is not provided then you will\nbe prompted to select the pipeline."),Object(i.b)("h4",null,"Git credentials"),Object(i.b)("p",null,"The command will prompt for the username and password/personal access token to access the Git repository, unless those are\nalready stored in a secret in the cluster namespace or provided as command-line parameters. The username and password can\nbe provided with the ",Object(i.b)("inlineCode",{parentName:"p"},"-u")," and ",Object(i.b)("inlineCode",{parentName:"p"},"-p")," flags. If you want to change the credentials that have already been stored in the\ncluster namespace, the ",Object(i.b)("inlineCode",{parentName:"p"},"-g")," argument an be provided and you will be prompted for the credentials."),Object(i.b)("h4",null,"Tekton template pipeline"),Object(i.b)("p",null,"If a Tekton pipeline will be used, a template pipeline must be selected for the new repository pipeline. The command\nreads the template pipelines available in the template namespace. The template namespace can be provided with the ",Object(i.b)("inlineCode",{parentName:"p"},"-t")," argument\nand will default to ",Object(i.b)("inlineCode",{parentName:"p"},"tools")," if not provided. The command will also filter the list of pipelines based on the runtime\ndetermined from the given repository."),Object(i.b)("p",null,"If there is more than one template pipeline available then you will be prompted to pick one. The template pipeline\ncan also be provided on the command-line using the ",Object(i.b)("inlineCode",{parentName:"p"},"--pipeline")," argument. If the name doesn’t match an available\npipeline then you will be prompted to select one."),Object(i.b)("h4",null,"Pipeline parameters"),Object(i.b)("p",null,"Once the pipeline template is selected, you will be prompted to provide values for the defined pipeline parameters. The\nvalues can also be provided from the command-line using the ",Object(i.b)("inlineCode",{parentName:"p"},"-p")," argument. The name of the parameter is listed at the\nbeginning of the prompt message. Multiple parameters can be provided by repeating the ",Object(i.b)("inlineCode",{parentName:"p"},"-p")," argument. For example:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-shell"},'oc pipeline --tekton "https://github.com/my-org/my-repo" -p scan-image=false -p edge=false\n')),Object(i.b)("h4",null,"Optional arguments"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"-u"),": the username for accessing the Git repo"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"-P"),": the password or personal access token for accessing the Git repo"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"-g"),": ignore existing ",Object(i.b)("inlineCode",{parentName:"li"},"git-credentials")," secret and prompt to update the values"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"-p"),": provide parameters for the pipeline"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"--jenkins"),": deploy using a Jenkins pipeline"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"--tekton"),": deploy using a Tekton pipeline"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"--pipeline"),": the name of the Tekton pipeline"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"-n"),": the deployment namespace; if not provided the namespace from the current context will be used"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"-t"),": the template namespace; if not provided the value will default to ",Object(i.b)("inlineCode",{parentName:"li"},"tools"))),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Usage")),Object(i.b)(h,{mdxType:"Tabs"},Object(i.b)(u,{label:"CLI",mdxType:"Tab"},"Create a Jenkins pipeline in the current namespace and prompt for the Git credentials",Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-shell",metastring:"script",script:!0},"oc pipeline --jenkins\n")),Object(i.b)("p",null,"Create a Tekton pipeline in the ",Object(i.b)("inlineCode",{parentName:"p"},"my-dev")," namespace, using the Git credentials ",Object(i.b)("inlineCode",{parentName:"p"},"gituser")," and ",Object(i.b)("inlineCode",{parentName:"p"},"gitpat")),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-shell",metastring:"script",script:!0},"oc pipeline -n my-dev -u gituser -P gitpat --tekton\n"))),Object(i.b)(u,{label:"Manual Steps for Tekton",mdxType:"Tab"},Object(i.b)("p",null,"The following is the list of steps required to manually configure a ",Object(i.b)("strong",{parentName:"p"},"Tekton"),"\npipeline with your development cluster."),Object(i.b)("br",null),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"Set the current namespace/project"),Object(i.b)("p",{parentName:"li"},Object(i.b)("strong",{parentName:"p"},"For OpenShift:")),Object(i.b)("pre",{parentName:"li"},Object(i.b)("code",{parentName:"pre",className:"language-shell",metastring:"script",script:!0},"oc project {namespace}\n")),Object(i.b)("p",{parentName:"li"},Object(i.b)("strong",{parentName:"p"},"For Kubernetes:")),Object(i.b)("pre",{parentName:"li"},Object(i.b)("code",{parentName:"pre",className:"language-shell",metastring:"script",script:!0},"kubectl config set-context --current --namespace={namespace}\n"))),Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"Copy the tasks from the ",Object(i.b)("inlineCode",{parentName:"p"},"tools")," namespace into the current namespace"),Object(i.b)("pre",{parentName:"li"},Object(i.b)("code",{parentName:"pre",className:"language-shell",metastring:"script",script:!0},"kubectl get tasks -o json -n tools | \\\n  jq 'del(.items[].metadata.uid) | del(.items[].metadata.selfLink) | del(.items[].metadata.resourceVersion) | del(.items[].metadata.namespace) | del(.items[].metadata.creationTimestamp) | del(.items[].metadata.generation) | del(.items[].metadata.annotations.\"kubectl.kubernetes.io/last-applied-configuration\")' | \\\n  kubectl apply -f -\n"))),Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"List the available pipeline templates in the ",Object(i.b)("inlineCode",{parentName:"p"},"tools")," namespace and select the one to use for your project."),Object(i.b)("pre",{parentName:"li"},Object(i.b)("code",{parentName:"pre",className:"language-shell",metastring:"script",script:!0},"kubectl get pipelines -n tools\n"))),Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"Clone the selected pipeline from the ",Object(i.b)("inlineCode",{parentName:"p"},"tools")," namespace into the current namespace"),Object(i.b)("pre",{parentName:"li"},Object(i.b)("code",{parentName:"pre",className:"language-shell",metastring:"script",script:!0},"kubectl get pipeline ${TEMPLATE_NAME} -o json -n tools | \\\n  jq --arg PIPELINE_NAME ${PIPELINE_NAME} '.metadata.name = $PIPELINE_NAME | del(.metadata.uid) | del(.metadata.selfLink) | del(.metadata.resourceVersion) | del(.metadata.namespace) | del(.metadata.creationTimestamp) | del(.metadata.generation) | del(.metadata.annotations.\"kubectl.kubernetes.io/last-applied-configuration\")' | \\\n  kubectl apply -f -\n")),Object(i.b)("p",{parentName:"li"},"where:"),Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"TEMPLATE_NAME")," is the name of the pipeline selected in the previous step"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"PIPELINE_NAME")," is the name of the pipeline for your project")))),Object(i.b)("h3",null,"Start the pipeline"),Object(i.b)("p",null,"The Tekton pipeline does not automatically start when it is first created. After the webhook is created in the subsequent steps the\npipeline will start when changes are pushed to the repository but before that, we can manually trigger the build to start using the CLI.\n(The pipeline can also be started through the OpenShift Console.)"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},"Kick off the pipeline using the Tekton CLI"),Object(i.b)("pre",{parentName:"li"},Object(i.b)("code",{parentName:"pre",className:"language-shell",metastring:"script",script:!0},"tkn pipeline start {PIPELINE_NAME} -s pipeline -p git-url={GIT_REPO} -p git-revision={GIT_BRANCH}\n"))),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},"To create a new PipelineRun with the same parameters from a previous PipelineRun you can do the following"),Object(i.b)("pre",{parentName:"li"},Object(i.b)("code",{parentName:"pre",className:"language-shell",metastring:"script",script:!0},"tkn pipeline start {PIPELINE_NAME} --use-pipelinerun {PIPELINE_RUN_NAME}\n")))),Object(i.b)("h3",null,"Create a Git Webhook"),Object(i.b)("h4",null,"Create the event listener and triggers"),Object(i.b)("p",null,"In order for a Tekton pipeline to be triggered by a webhook notification, several resources need to be created:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"TriggerTemplate")," - defines how to create the PipelineRun and any other required resources when a webhook notification is received."),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"TriggerBinding")," - provides a mapping for the information available in the webhook payload into the TriggerTemplate"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"EventListener")," - makes the connection between the Pipeline, TriggerBinding, and TriggerTemplate together that will be created when a webhook is triggered")),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"Create a file named ",Object(i.b)("inlineCode",{parentName:"p"},"tekton-trigger.yaml")," and paste in the following contents:"),Object(i.b)("pre",{parentName:"li"},Object(i.b)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: triggers.tekton.dev/v1alpha1\nkind: TriggerTemplate\nmetadata:\n  labels:\n    app: {PIPELINE_NAME}\n  name: {TRIGGER_TEMPLATE_NAME}\nspec:\n  params:\n  - description: The git revision\n    name: gitrevision\n  - description: The git repository url\n    name: gitrepositoryurl\n  resourcetemplates:\n  - apiVersion: tekton.dev/v1beta1\n    kind: PipelineRun\n    metadata:\n      generateName: {PIPELINE_NAME}-\n    spec:\n      params:\n      - name: git-url\n        value: $(params.gitrepositoryurl)\n      - name: git-revision\n        value: $(params.gitrevision)\n      - name: scan-image\n        value: \"false\"\n      pipelineRef:\n        name: {PIPELINE_NAME}\n---\napiVersion: triggers.tekton.dev/v1alpha1\nkind: TriggerBinding\nmetadata:\n  labels:\n    app: {PIPELINE_NAME}\n  name: {TRIGGER_BINDING_NAME}\nspec:\n  params:\n  - name: gitrevision\n    value: $(body.head_commit.id)\n  - name: gitrepositoryurl\n    value: $(body.repository.url)\n---\napiVersion: triggers.tekton.dev/v1alpha1\nkind: EventListener\nmetadata:\n  labels:\n    app: {PIPELINE_NAME}\n  name: {EVENT_LISTENER_NAME}\nspec:\n  serviceAccountName: pipeline\n  triggers:\n  - bindings:\n    - kind: TriggerBinding\n      name: {TRIGGER_BINDING_NAME}\n    interceptors:\n    - cel:\n        filter: header.match('X-GitHub-Event', 'push') && body.ref == 'refs/heads/{BRANCH_NAME}'\n    name: {PIPELINE_NAME}\n    template:\n      name: {TRIGGER_TEMPLATE_NAME}\n"))),Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"Replace the place holder values with the appropriate values:"),Object(i.b)("p",{parentName:"li"},"where:"),Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"{PIPELINE_NAME}")," is the name of your Pipeline resource from the previous section."),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"{TRIGGER_TEMPLATE_NAME}")," is the name of the TriggerTemplate. This can be the same as the ",Object(i.b)("inlineCode",{parentName:"li"},"{PIPELINE_NAME}"),"."),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"{TRIGGER_BINDING_NAME}")," is the name of the TriggerBinding. This can be the same as the ",Object(i.b)("inlineCode",{parentName:"li"},"{PIPELINE_NAME}"),"."),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"{EVENT_LISTENER_NAME}")," is the name of the EventListener. This can be ",Object(i.b)("inlineCode",{parentName:"li"},"el-{PIPELINE_NAME}")," if the EventListeners will be configured one-to-one with the Pipelines or the instance can be shared across the project."),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"{BRANCH_NAME}")," is the name of the branch from which webhook events should trigger the build to start"))),Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"Apply the trigger resources to the cluster, in the same namespace where the Pipeline was created"),Object(i.b)("pre",{parentName:"li"},Object(i.b)("code",{parentName:"pre",className:"language-shell",metastring:"script",script:!0},"kubectl apply -f tekton-trigger.yaml\n"))),Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"In order for the Git repository to trigger the build with a webhook, an endpoint needs to be available. Expose the EventListener service with a route to provide that endpoint."),Object(i.b)("pre",{parentName:"li"},Object(i.b)("code",{parentName:"pre",className:"language-shell",metastring:"script",script:!0},"oc expose service ${EVENT_LISTENER_NAME} --name=${EVENT_LISTENER_NAME}\n")))),Object(i.b)("h4",null,"Register the webhook url with your Git repository"),Object(i.b)("p",null,"The particular steps will vary to create the Webhook depending on the flavor of hosted Git you are using (GitHub, GitHub Enterprise, GitLab, BitBucket, etc)\nbut the general flow will remain the same."),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"Get the host name for the route created in the previous step"),Object(i.b)("pre",{parentName:"li"},Object(i.b)("code",{parentName:"pre",className:"language-shell",metastring:"script",script:!0},"oc get route ${EVENT_LISTENER_NAME} -o jsonpath='{.spec.host}'\n"))),Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"Create a webhook in your hosted Git repository using the https url of the host name from the previous step that is triggered by the desired events (e.g. push, pull request, release)")))),Object(i.b)(u,{label:"Manual steps for Jenkins on OpenShift",mdxType:"Tab"},Object(i.b)("h3",null,"1. Provision Jenkins ephemeral"),Object(i.b)("p",null,"Jenkins ephemeral provides a kubernetes native version of Jenkins that dynamically provisions build agents on-demand.\nIt’s ",Object(i.b)("em",{parentName:"p"},"ephemeral")," meaning it doesn’t allocate any persistent storage in the cluster."),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"Set the project/namespace"),Object(i.b)("pre",{parentName:"li"},Object(i.b)("code",{parentName:"pre",className:"language-shell",metastring:"script",script:!0},"oc project {NAMESPACE}\n")),Object(i.b)("p",{parentName:"li"},"where:"),Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"{NAMESPACE}")," is the development namespace where the pipelines will run"))),Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"Run the following command to provision the Jenkins instance in your namespace"),Object(i.b)("pre",{parentName:"li"},Object(i.b)("code",{parentName:"pre",className:"language-shell",metastring:"script",script:!0},"oc new-app jenkins-ephemeral\n"))),Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"Open the OpenShift console as described in the login steps above")),Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"Select ",Object(i.b)("inlineCode",{parentName:"p"},"Workloads -> Pods")," from the left-hand menu")),Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"At the top of the page select your project/namespace from the drop-down list to see the Jenkins instance running"))),Object(i.b)("h3",null,"2. Give the ",Object(i.b)("inlineCode",{parentName:"h3"},"jenkins")," service account ",Object(i.b)("inlineCode",{parentName:"h3"},"privileged")," access"),Object(i.b)("p",null,"All of the ",Object(i.b)(o.a,{name:"shortName",mdxType:"Globals"})," pipelines use ",Object(i.b)("inlineCode",{parentName:"p"},"buildah")," to build and push the container image to the registry.\nUnfortunately, the ",Object(i.b)("inlineCode",{parentName:"p"},"buildah")," container must run as root. By default, OpenShift does not allow containers to run as the\nroot user and special permission is required for the pipeline to run."),Object(i.b)("p",null,"With the Jenkins build engine, all the build processes run as the ",Object(i.b)("inlineCode",{parentName:"p"},"jenkins")," service account. In order for the pipeline\ncontainer to run as root on OpenShift we will need to give the ",Object(i.b)("inlineCode",{parentName:"p"},"privileged")," security context constraint (scc) to\n",Object(i.b)("inlineCode",{parentName:"p"},"jenkins")," service account with the following command:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-shell",metastring:"script",script:!0},"oc project {NAMESPACE}\noc adm policy add-scc-to-user privileged -z jenkins\n")),Object(i.b)("p",null,"where:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"{NAMESPACE}")," should be the name you claimed in the box note prefixed to ",Object(i.b)("inlineCode",{parentName:"li"},"-dev")," (e.g. user01-dev)")),Object(i.b)("h3",null,"3. Create a secret with git credentials"),Object(i.b)("p",null,"In order for Jenkins to have access to the git repository, particularly if it is a private repository, a Kubernetes\nsecret needs to be added that contains the git credentials."),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"Create a personal access token (if you don’t already have one) using the prereq instructions -\n",Object(i.b)("a",{parentName:"p",href:"https://cloudnativetoolkit.dev/getting-started/prereqs#configure-github-personal-access-token"},"https://cloudnativetoolkit.dev/getting-started/prereqs#configure-github-personal-access-token"))),Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"Copy the following into a file called ",Object(i.b)("inlineCode",{parentName:"p"},"gitsecret.yaml")," and update the {Git-Username}, and {Git-PAT}"),Object(i.b)("pre",{parentName:"li"},Object(i.b)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: v1\nkind: Secret\nmetadata:\n  annotations:\n    build.openshift.io/source-secret-match-uri-1: https://github.com/*\n  labels:\n    jenkins.io/credentials-type: usernamePassword\n  name: git-credentials\ntype: kubernetes.io/basic-auth\nstringData:\n  username: {Git-Username}\n  password: {Git-PAT}\n")),Object(i.b)("p",{parentName:"li"},"where:"),Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"Git-Username")," is the username that has access to the git repo"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"Git-PAT")," is the personal access token of the git user"))),Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"After logging into the cluster, create the secret by running the following:"),Object(i.b)("pre",{parentName:"li"},Object(i.b)("code",{parentName:"pre",className:"language-shell",metastring:"script",script:!0},"oc project {NAMESPACE}\noc create -f gitsecret.yaml\n")),Object(i.b)("p",{parentName:"li"},"where:"),Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"{NAMESPACE}")," is the development namespace where the pipelines will run")))),Object(i.b)("h3",null,"3. Create the build config"),Object(i.b)("p",null,"On OpenShift 4.3, Jenkins is built into the OpenShift console and the build pipelines can be managed using Kubernetes\ncustom resources. The following steps will create one by hand to create the build pipeline for the new application."),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"Copy the following into a file called ",Object(i.b)("inlineCode",{parentName:"p"},"buildconfig.yaml")," and update the {Name}, {Secret}, {Git-Repo-URL},\nand {Namespace}"),Object(i.b)("pre",{parentName:"li"},Object(i.b)("code",{parentName:"pre"},"```yaml\napiVersion: v1\nkind: BuildConfig\nmetadata:\n  name: {Name}\nspec:\n  triggers:\n  - type: GitHub\n    github:\n      secret: my-secret-value\n  source:\n    git:\n      uri: {Git-Repo-URL}\n      ref: master\n  strategy:\n    jenkinsPipelineStrategy:\n      jenkinsfilePath: Jenkinsfile\n      env:\n      - name: CLOUD_NAME\n        value: openshift\n      - name: NAMESPACE\n        value: {NAMESPACE}\n```\n\nwhere:\n - `Name` is in the name of your pipeline\n - `Git-Repo-URL` is the https url to the git repository\n - `{NAMESPACE}` is the development namespace where the pipelines will run\n"))),Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"Assuming you are still logged into the cluster, create the buildconfig resource in the cluster"),Object(i.b)("pre",{parentName:"li"},Object(i.b)("code",{parentName:"pre",className:"language-shell",metastring:"script",script:!0},"oc project {NAMESPACE}\noc create -f buildconfig.yaml\n")),Object(i.b)("p",{parentName:"li"},"where:"),Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"{NAMESPACE}")," is the development namespace where the pipelines will run")))),Object(i.b)("h3",null,"4. View the pipeline in the OpenShift console"),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},"Open the OpenShift console for the cluster"),Object(i.b)("li",{parentName:"ol"},"Select Builds -> Build Config"),Object(i.b)("li",{parentName:"ol"},"Select your project/namespace (i.e. ",Object(i.b)("inlineCode",{parentName:"li"},"{NAMESPACE}"),") from the top"),Object(i.b)("li",{parentName:"ol"},"The build pipeline that was created in the previous step should appear"),Object(i.b)("li",{parentName:"ol"},"Manually trigger the pipeline by selecting ",Object(i.b)("inlineCode",{parentName:"li"},"Start Build")," the menu button on the right side of the row")),Object(i.b)("h3",null,"5. Create the webhook"),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"Run the following to get the webhook details from the build config"),Object(i.b)("pre",{parentName:"li"},Object(i.b)("code",{parentName:"pre",className:"language-shell",metastring:"script",script:!0},"oc project {NAMESPACE}\noc describe bc {Name}\n")),Object(i.b)("p",{parentName:"li"},"where:"),Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"{Name}")," is the name used in the previous step for the build config"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"{NAMESPACE}")," is the development namespace where the pipelines will run")),Object(i.b)("p",{parentName:"li"},"The webhook url will have a structure similar to:"),Object(i.b)("p",{parentName:"li"},Object(i.b)("inlineCode",{parentName:"p"},"http://{openshift_api_host:port}/oapi/v1/namespaces/{namespace}/buildconfigs/{name}/webhooks/{secret}/generic")),Object(i.b)("p",{parentName:"li"},"In this case ",Object(i.b)("inlineCode",{parentName:"p"},"{secret}")," will be ",Object(i.b)("inlineCode",{parentName:"p"},"my-secret-value"))),Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"Open a browser to the GitHub repo deployed in the previous step in the build config")),Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"Select ",Object(i.b)("inlineCode",{parentName:"p"},"Settings")," then ",Object(i.b)("inlineCode",{parentName:"p"},"Webhooks"),". Press ",Object(i.b)("inlineCode",{parentName:"p"},"Add webhook"))),Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"Paste the webhook url from the previous step into the ",Object(i.b)("inlineCode",{parentName:"p"},"Payload url"))),Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"Set the content-type to ",Object(i.b)("inlineCode",{parentName:"p"},"application/json")," and leave the rest of the values as the defaults")),Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"Press ",Object(i.b)("inlineCode",{parentName:"p"},"Add webhook")," to create the webhook")),Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"Press the button to test the webhook to ensure that everything was done properly")),Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"Go back to your project code and push a change to one of the files")),Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"Go to the Build pipeline page in the OpenShift console to see that the build was triggered")))),Object(i.b)(u,{label:"Manual steps for Jenkins on Kubernetes",mdxType:"Tab"},Object(i.b)("p",null,"TBD"))),Object(i.b)("h3",null,"enable"),Object(i.b)("p",null,"Adds DevOps artifacts to a Git repo that the ",Object(i.b)(o.a,{name:"env",mdxType:"Globals"})," uses to deploy the app. The command displays a\nlist of available pipelines and applies the one you select to your code repo. The DevOps files added to your repo\ninclude (but are not limited to):"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Helm chart"),Object(i.b)("li",{parentName:"ul"},"Jenkinsfile")),Object(i.b)("p",null,"This command DOES NOT require that the terminal is already logged in to an IBM Cloud account nor the cluster. It DOES\nrequire that the terminal’s current directory is the repository directory for your local copy of the Git repo."),Object(i.b)("p",null,"The command will add files to the local repo. You should commit these new files and push them to the server repo.\nThen run ",Object(i.b)("inlineCode",{parentName:"p"},"igc pipeline")," to connect your repo to a pipeline in the environment."),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Command flags")),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"--repo"),": the set of pipelines to choose from; the default is ",Object(i.b)("a",{parentName:"li",href:"https://github.com/cloud-native-toolkit/garage-pipelines"},"https://github.com/cloud-native-toolkit/garage-pipelines")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"-p"),": the name of the pipeline that should be installed; if not provided then you will be prompted"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"-b"),": the branch from which the pipeline should be installed; the default is ",Object(i.b)("inlineCode",{parentName:"li"},"stable")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"r"),": the version number of the pipeline that should be installed; the default is ",Object(i.b)("inlineCode",{parentName:"li"},"latest"))),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Usage")),Object(i.b)(h,{mdxType:"Tabs"},Object(i.b)(u,{label:"CLI",mdxType:"Tab"},Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"Before running the command, make sure you have a clean repository with no unstaged changes. Either commit any\nchanges or stash them temporarily with ",Object(i.b)("inlineCode",{parentName:"p"},"git stash"),". It is particularly important that any changes to the pipeline be\ndealt with.")),Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"Apply the pipeline updates using the CLI command"),Object(i.b)("pre",{parentName:"li"},Object(i.b)("code",{parentName:"pre",className:"language-shell",metastring:"script",script:!0},"igc enable\n"))),Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"Review the changes using ",Object(i.b)("inlineCode",{parentName:"p"},"git diff")," and revert any application-specific changes that should remain (e.g.\ncustomization to the Jenkins pipeline in the ",Object(i.b)("inlineCode",{parentName:"p"},"Jenkinsfile"),", specific values added to ",Object(i.b)("inlineCode",{parentName:"p"},"values.yaml"),", customizations\nto the templates in the ",Object(i.b)("inlineCode",{parentName:"p"},"helm chart"),")")),Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"Commit the changes when you are happy with them")))),Object(i.b)(u,{label:"Manual steps",mdxType:"Tab"},Object(i.b)("p",null,"The follow provides the manual steps equivalent to the ",Object(i.b)("inlineCode",{parentName:"p"},"igc enable")," command:"),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"Before updating the pipelines, make sure you have a clean repository with no unstaged changes. Either commit any\nchanges or stash them temporarily with ",Object(i.b)("inlineCode",{parentName:"p"},"git stash"),". It is particularly important that any changes to the pipeline be\ndealt with.")),Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"Download the ",Object(i.b)("inlineCode",{parentName:"p"},"index.yaml")," file containing the available pipeline versions"),Object(i.b)("pre",{parentName:"li"},Object(i.b)("code",{parentName:"pre",className:"language-shell",metastring:"script",script:!0},"curl -O https://cloud-native-toolkit.github.io/garage-pipelines/index.yaml\n"))),Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"Look through the ",Object(i.b)("inlineCode",{parentName:"p"},"index.yaml")," file to identify the url for the desired pipeline branch and version")),Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"With the PIPELINE_URL from the previous step, run the following to download the pipeline tar-ball"),Object(i.b)("pre",{parentName:"li"},Object(i.b)("code",{parentName:"pre",className:"language-shell",metastring:"script",script:!0},"curl -O ${PIPELINE_URL}\n"))),Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"Extract the tar-ball into your repository directory. You will be prompted to overwrite files. Overwrite as appropriate"),Object(i.b)("pre",{parentName:"li"},Object(i.b)("code",{parentName:"pre",className:"language-shell",metastring:"script",script:!0},"tar xzf ${PIPELINE_FILE}\n"))),Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"Review the changes using ",Object(i.b)("inlineCode",{parentName:"p"},"git diff")," and revert any application-specific changes that should remain (e.g.\ncustomization to the Jenkins pipeline in the ",Object(i.b)("inlineCode",{parentName:"p"},"Jenkinsfile"),", specific values added to ",Object(i.b)("inlineCode",{parentName:"p"},"values.yaml"),", customizations\nto the templates in the ",Object(i.b)("inlineCode",{parentName:"p"},"helm chart"),")")),Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"Commit the changes when you are happy with them"))))),Object(i.b)("h3",null,"git-secret"),Object(i.b)("p",null,"Creates a kubernetes secret that contains the username and personal access token for a git repo and a config map that\ncontains the url, host, org, repo, and branch for the git repository. The secret is always named ",Object(i.b)("inlineCode",{parentName:"p"},"git-credentials")," and the config map\nis named ",Object(i.b)("inlineCode",{parentName:"p"},"{git org}.{git repo}"),". The config map and secret will be created in the currently selected namespace/project,\nunless a value is passed with the ",Object(i.b)("inlineCode",{parentName:"p"},"-n")," flag. If the ",Object(i.b)("inlineCode",{parentName:"p"},"git-credentials")," secret already exists then it won’t be\nreplaced/updated it won’t be updated unless the ",Object(i.b)("inlineCode",{parentName:"p"},"--replace")," argument is passed."),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Command flags")),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"[positional]"),": overwrites the name of the config map"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"-n"),": the namespace where the secret and config map should be created. Defaults to the currently selected project/namespace"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"-d"),": the directory where the cloned repository is located. Defaults to the current working directory"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"-u"),": the username for the git secret, If not provided the value will be collected from a prompt"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"-p"),": the personal access token, If not provided the value will be collected from a prompt"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"--values"),": an optional yaml file that contains additional attributes to add to the secret"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"--replace"),": flag indicating that the secret should be replaced/updated if it already exists")),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Usage")),Object(i.b)(h,{mdxType:"Tabs"},Object(i.b)(u,{label:"CLI",mdxType:"Tab"},Object(i.b)("p",null,"The following gives an example of using the ",Object(i.b)("inlineCode",{parentName:"p"},"git-secret")," command to set up the config map and secret in the ",Object(i.b)("inlineCode",{parentName:"p"},"dev")," namespace"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-shell",metastring:"script",script:!0},"igc git-secret -n dev\n"))),Object(i.b)(u,{label:"Manual",mdxType:"Tab"},Object(i.b)("p",null,"The following gives the equivalent commands to create the config map and secret for a git repository in the ",Object(i.b)("inlineCode",{parentName:"p"},"dev")," namespace"),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"Create the ",Object(i.b)("inlineCode",{parentName:"p"},"git-credentials")," secret"),Object(i.b)("pre",{parentName:"li"},Object(i.b)("code",{parentName:"pre",className:"language-shell",metastring:"script",script:!0},'kubectl create secret generic git-credentials -n dev \\\n  --from-literal=username={git username} \\\n  --from-literal=password={git personal access token} \\\n  --dry-run --output=yaml | \\\nkubectl label -f - --local --dry-run --output=yaml \\\n  "jenkins.io/credentials-type=usernamePassword" | \\\nkubectl annotate -f - --local --dry-run --output=yaml \\\n  "build.openshift.io/source-secret-match-uri-1=https://github.com/*" \\\n  "tekton.dev/git-0=https://github.com" | \\\nkubectl apply -f -\n'))),Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"Create the config map for a git repo located at ",Object(i.b)("inlineCode",{parentName:"p"},"https://github.com/showcase/myrepo")),Object(i.b)("pre",{parentName:"li"},Object(i.b)("code",{parentName:"pre",className:"language-shell",metastring:"script",script:!0},"kubectl create configmap showcase.myrepo -n dev \\\n  --from-literal=host=github.com \\\n  --from-literal=org=showcase \\\n  --from-literal=repo=myrepo \\\n  --from-literal=url=https://github.com/showcase/myrepo \\\n  --from-literal=branch=master\n")))))),Object(i.b)("h3",null,"gitops"),Object(i.b)("p",null,"Creates a kubernetes secret that contains the username and personal access token for a git repo and a config map that\ncontains the url, host, org, repo, and branch for the git repository. The secret is always named ",Object(i.b)("inlineCode",{parentName:"p"},"git-credentials")," and the config map\nis named ",Object(i.b)("inlineCode",{parentName:"p"},"gitops-repo"),". The config map and secret will be created in the currently selected namespace/project,\nunless a value is passed with the ",Object(i.b)("inlineCode",{parentName:"p"},"-n")," flag. If the ",Object(i.b)("inlineCode",{parentName:"p"},"git-credentials")," secret already exists then it won’t be\nreplaced/updated unless the ",Object(i.b)("inlineCode",{parentName:"p"},"--replace")," argument is passed."),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Command flags")),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"-n"),": the namespace where the secret and config map should be created. Defaults to the currently selected project/namespace"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"-d"),": the directory where the cloned repository is located. Defaults to the current working directory"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"-u"),": the username for the git secret, If not provided the value will be collected from a prompt"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"-p"),": the personal access token, If not provided the value will be collected from a prompt"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"--values"),": an optional yaml file that contains additional attributes to add to the secret"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"--replace"),": flag indicating that the secret should be replaced/updated if it already exists")),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Usage")),Object(i.b)(h,{mdxType:"Tabs"},Object(i.b)(u,{label:"CLI",mdxType:"Tab"},Object(i.b)("p",null,"The following gives an example of using the ",Object(i.b)("inlineCode",{parentName:"p"},"gitops")," command to set up the config map and secret in the ",Object(i.b)("inlineCode",{parentName:"p"},"dev")," namespace"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-shell",metastring:"script",script:!0},"igc gitops -n dev\n"))),Object(i.b)(u,{label:"Manual",mdxType:"Tab"},Object(i.b)("p",null,"The following gives the equivalent commands to create the config map and secret for a git repository in the ",Object(i.b)("inlineCode",{parentName:"p"},"dev")," namespace"),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"Create the ",Object(i.b)("inlineCode",{parentName:"p"},"git-credentials")," secret"),Object(i.b)("pre",{parentName:"li"},Object(i.b)("code",{parentName:"pre",className:"language-shell",metastring:"script",script:!0},'kubectl create secret generic git-credentials -n dev \\\n  --from-literal=username={git username} \\\n  --from-literal=password={git personal access token} \\\n  --dry-run --output=yaml | \\\nkubectl label -f - --local --dry-run --output=yaml \\\n  "jenkins.io/credentials-type=usernamePassword" | \\\nkubectl annotate -f - --local --dry-run --output=yaml \\\n  "build.openshift.io/source-secret-match-uri-1=https://github.com/*" \\\n  "tekton.dev/git-0=https://github.com" | \\\nkubectl apply -f -\n'))),Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"Create the config map for a git repo located at ",Object(i.b)("inlineCode",{parentName:"p"},"https://github.com/showcase/myrepo")),Object(i.b)("pre",{parentName:"li"},Object(i.b)("code",{parentName:"pre",className:"language-shell",metastring:"script",script:!0},"kubectl create configmap github-repo -n dev \\\n  --from-literal=host=github.com \\\n  --from-literal=org=showcase \\\n  --from-literal=repo=myrepo \\\n  --from-literal=url=https://github.com/showcase/myrepo \\\n  --from-literal=branch=master\n")))))),Object(i.b)("h3",null,"tool-config"),Object(i.b)("p",null,"Configures a new tool in the environment. After deploying the tool, use this command to add the tool to the list of\ncredentials so that it will be displayed in the dashboard."),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Command flags")),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"The name for the tool"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"-n"),": the tools namespace; the default is ",Object(i.b)("inlineCode",{parentName:"li"},"tools")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"--url"),": the endpoint for accessing the tool, usually its dashboard"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"--username"),": (optional) the user name for logging into to tool"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"--password"),": (optional) the password for logging into to tool")),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Usage")),Object(i.b)(h,{mdxType:"Tabs"},Object(i.b)(u,{label:"CLI",mdxType:"Tab"},Object(i.b)("p",null,"The following gives an example of using the ",Object(i.b)("inlineCode",{parentName:"p"},"tool-config")," command to set up a tool named ",Object(i.b)("inlineCode",{parentName:"p"},"my-tool")," with its\ndashboard’s endpoint and credentials"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-shell",metastring:"script",script:!0},"igc tool-config my-tool \\\n  --url https://mytool-dashboard.mycluster.us-east.containers.appdomain.cloud \\\n  --username admin \\\n  --password password\n"))),Object(i.b)(u,{label:"Manual install with helm",mdxType:"Tab"},Object(i.b)("p",null,"The following gives an example of using helm directly to do the equivalent (using helm 3):"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-shell",metastring:"script",script:!0},"helm install my-tool tool-config \\\n  --repo https://cloud-native-toolkit.github.io/toolkit-charts/ \\\n  --set url=https://mytool-dashboard.mycluster.us-east.containers.appdomain.cloud \\\n  --set username=admin \\\n  --set password=password\n")))),Object(i.b)("h3",null,"vlan"),Object(i.b)("p",null,"Lists the VLANs for a particular IBM Cloud region. This information is useful for preparing Terraform cluster creation\nsteps. The command reads all the data centers in the region and allows you to select the appropriate data center for\nthe vlan."),Object(i.b)("p",null,"This command requires that the terminal is already logged in to the cloud region. It does NOT need to be logged in to a cluster."),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Usage")),Object(i.b)(h,{mdxType:"Tabs"},Object(i.b)(u,{label:"CLI",mdxType:"Tab"},Object(i.b)("p",null,"List a pair of public/private VLANs for a new environment to use"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-shell",metastring:"script",script:!0},"igc vlan\n"))),Object(i.b)(u,{label:"Manual steps",mdxType:"Tab"},Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"List the zones for the region"),Object(i.b)("pre",{parentName:"li"},Object(i.b)("code",{parentName:"pre",className:"language-shell",metastring:"script",script:!0},"ibmcloud ks zones --region-only --provider classic\n"))),Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"Select the desired zone from the listing provided by the previous command and run the following to list the vlans for that zone"),Object(i.b)("pre",{parentName:"li"},Object(i.b)("code",{parentName:"pre",className:"language-shell",metastring:"script",script:!0},"ibmcloud ks vlans --zone ${zone}\n")))))))}j.isMDXComponent=!0},XbGe:function(e,t,n){"use strict";var a=n("q1tI"),l=n.n(a),i=n("NmYn"),r=n.n(i),o=n("Wbzz"),c=n("Xrax"),p=n("k4MR"),s=n("TSYQ"),b=n.n(s),m=n("QH2O"),d=n.n(m),h=n("qKvR"),u=function(e){var t,n=e.title,a=e.theme,l=e.tabs,i=void 0===l?[]:l;return Object(h.b)("div",{className:b()(d.a.pageHeader,(t={},t[d.a.withTabs]=i.length,t[d.a.darkMode]="dark"===a,t))},Object(h.b)("div",{className:"bx--grid"},Object(h.b)("div",{className:"bx--row"},Object(h.b)("div",{className:"bx--col-lg-12"},Object(h.b)("h1",{id:"page-title",className:d.a.text},n)))))},g=n("BAC9"),O=function(e){var t=e.relativePagePath,n=e.repository,a=Object(o.useStaticQuery)("1364590287").site.siteMetadata.repository,l=n||a,i=l.baseUrl,r=l.subDirectory,c=i+"/edit/"+l.branch+r+"/src/pages"+t;return i?Object(h.b)("div",{className:"bx--row "+g.row},Object(h.b)("div",{className:"bx--col"},Object(h.b)("a",{className:g.link,href:c},"Edit this page on GitHub"))):null},j=n("dI71"),N=n("I8xM"),f=function(e){function t(){return e.apply(this,arguments)||this}return Object(j.a)(t,e),t.prototype.render=function(){var e=this.props,t=e.tabs,n=e.slug,a=n.split("/").filter(Boolean).slice(-1)[0],l=t.map((function(e){var t,l=r()(e,{lower:!0,strict:!0}),i=l===a,c=new RegExp(a+"/?(#.*)?$"),p=n.replace(c,l);return Object(h.b)("li",{key:e,className:b()((t={},t[N.selectedItem]=i,t),N.listItem)},Object(h.b)(o.Link,{className:N.link,to:""+p},e))}));return Object(h.b)("div",{className:N.tabsContainer},Object(h.b)("div",{className:"bx--grid"},Object(h.b)("div",{className:"bx--row"},Object(h.b)("div",{className:"bx--col-lg-12 bx--col-no-gutter"},Object(h.b)("nav",null,Object(h.b)("ul",{className:N.list},l))))))},t}(l.a.Component),y=n("MjG9"),v=n("CzIb");t.a=function(e){var t=e.pageContext,n=e.children,a=e.location,l=e.Title,i=t.frontmatter,s=void 0===i?{}:i,b=t.relativePagePath,m=t.titleType,d=s.tabs,g=s.title,j=s.theme,N=s.description,w=s.keywords,C=Object(v.a)().interiorTheme,T=Object(o.useStaticQuery)("223705900").site.pathPrefix,E=T?a.pathname.replace(T,""):a.pathname,k=d?E.split("/").filter(Boolean).slice(-1)[0]||r()(d[0],{lower:!0}):"",I=j||C;return Object(h.b)(p.a,{tabs:d,homepage:!1,theme:I,pageTitle:g,pageDescription:N,pageKeywords:w,titleType:m},Object(h.b)(u,{title:l?Object(h.b)(l,null):g,label:"label",tabs:d,theme:I}),d&&Object(h.b)(f,{slug:E,tabs:d,currentTab:k}),Object(h.b)(y.a,{padded:!0},n,Object(h.b)(O,{relativePagePath:b})),Object(h.b)(c.a,null))}}}]);
//# sourceMappingURL=component---src-pages-getting-started-cli-index-mdx-7c11faa3388c28b3e553.js.map
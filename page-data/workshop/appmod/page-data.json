{"componentChunkName":"component---src-pages-workshop-appmod-index-mdx","path":"/workshop/appmod/","result":{"pageContext":{"frontmatter":{"title":"Workshop - Application Modernization DevOps, Monolith to Container"},"relativePagePath":"/workshop/appmod/index.mdx","titleType":"page","MdxNode":{"id":"254b6ca5-afd2-55e2-95ca-36775a1bbd0e","children":[],"parent":"e7f3d6f1-d516-599d-a9c9-c35c5c70b034","internal":{"content":"---\ntitle: Workshop - Application Modernization DevOps, Monolith to Container\n---\n\nimport Globals from 'gatsby-theme-carbon/src/templates/Globals';\n\n<PageDescription>\n\n<iframe width=\"560\" height=\"315\" src=\"https://www.youtube.com/embed/ss9joPm2M1U\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen></iframe>\n\n\n- Application Modernization DevOps, Monolith to Container.\n- The following steps will deploy the modernized Customer Order Services application in a WebSphere Liberty container to a Red Hat OpenShift cluster.\n- The DevOps process is composed of Continous Integration (CI) with OpenShift Pipelines (Tekton) and Continous Deployment (CD) with GitOps engine ArgoCD\n\n</PageDescription>\n\n1. Prerequisites\n    - The instructor should [Setup Workshop Environment](/workshop/setup)\n    - The student should [Setup CLI and Terminal Shell](/workshop/setup#4.-(optional)-auto-configure-terminal-shell)\n    - An user with cluster-admin (ie kubeadmin) needs to deploy a DB2 instance to be shared by all the users\n    ```bash\n    oc new-project db2\n    oc create -n db2 serviceaccount mysvcacct\n    oc adm policy add-scc-to-user privileged system:serviceaccount:db2:mysvcacct\n    oc apply -n db2 -f \"http://$(oc get route -n tools gogs --template='{{.spec.host}}')/toolkit/appmod-liberty-toolkit/raw/master/db2/db2-dc.yaml\"\n    oc apply -n db2 -f \"http://$(oc get route -n tools gogs --template='{{.spec.host}}')/toolkit/appmod-liberty-toolkit/raw/master/db2/db2-service.yaml\"\n    ```\n\n1. (Optional) Analyze the application using the following guide [Modernizing runtimes with Liberty](https://ibm-cloud-architecture.github.io/modernization-playbook/applications/liberty/liberty-analyze)\n    - Download [Transformation Advisor](https://www.ibm.com/garage/method/practices/learn/ibm-transformation-advisor/)\n    - The results of a Data Collector is already provided provided download <a href=\"/AppSrv01.zip\" target=\"_blank\">AppSrv01.zip</a>\n    - Upload the data collection into Transformation Advisor\n    - Review the CustomerOrderServicesApp.ear analysis\n    - The migration path files have been deployed to git for this lab.\n\n1. Instructor will provide the following info:\n    - OpenShift Console URL (OCP_CONSOLE_URL)\n    - The username and password for OpenShift and Git Server (default values are user1, user2, etc.. for users and `password` for password).\n\n1. Set `TOOLKIT_USERNAME` environment variable replace `user1` with assigned usernames\n    ```bash\n    TOOLKIT_USERNAME=user1\n    ```\n1. **(Skip if using KubeAdmin or IBM Cloud)** Login into OpenShift using `oc`\n    - If you are using an IBM Cloud cluster login with your IBM account email and IAM API Key or Token, if using a cluster that was configured with the workshop scripts outside IBM Cloud then use `user1` or respective assigned username, and the password is `password`\n    ```bash\n    oc login $OCP_URL -u $TOOLKIT_USERNAME -p password\n    ```\n\n1. Set `TOOLKIT_PROJECT` environment variable replace `project1` or `projectx` based on user id assigned\n    ```bash\n    TOOLKIT_PROJECT=project1\n    ```\n\n1. Create a project/namespace using your project prefix, and `-dev` and suffix\n    ```bash\n    oc sync $TOOLKIT_PROJECT-dev\n    ```\n\n1. Fork Inventory Sample Application Java\n    - Open Developer Dashboard from the OpenShift Console\n    - Select Starter Kits\n    - Select **Liberty AppMod** (Java)\n    - Click Fork\n    - Login into GIT Sever using the provided username and password (ie `user1` and `password`)\n    - Click **Fork Repository**\n\n1. Setup environment variable `GIT_URL` for the git url using the value from previous step or as following\n    ```bash\n    GIT_REPO=appmod-liberty-toolkit\n    GIT_URL=http://${TOOLKIT_USERNAME}:password@$(oc get route -n tools gogs --template='{{.spec.host}}')/${TOOLKIT_USERNAME}/${GIT_REPO}\n    echo GIT_URL=${GIT_URL}\n    ```\n\n1. Create a pipeline for the application\n    ```bash\n    oc pipeline --tekton \\\n    ${GIT_URL}#master \\\n    --pipeline ibm-appmod-liberty \\\n    -p scan-image=false \\\n    -p health-endpoint=/ \\\n    -p java-bin-path=CustomerOrderServicesApp/target\n    ```\n    - Notice above that the Toolkit `pipeline` CLI plugin accepts pipeline names and parameters\n    - The endpoint to check that the external access is possible is `/`\n    - The Java bin path is not located based on the root of the git repository and instead in `CustomerOrderServicesApp/target`\n    - Every application would have custom values you can pass them to the pipeline as parameters.\n\n1. Verity that the Pipeline started using the URL printed by the command\n\n1. This is a good moment to take a break as the pipelines will take a few minutes.\n\n1. Verify that Pipeline Run completed successfully\n\n1. Review the Pipeline Tasks/Stages\n    - Test\n    - Open SonarQube from Console Link\n    - Open Registry from Console Link\n    - Open Artifactory from Console Link\n\n1. Review the Application in GitOps git reposistory. The pipeline step `gitops` is pushing the application manifest into the GitOps git repository\n    - Open **Git Ops** from Console link\n    - Navigate to `project1/qa/project1/appmod-liberty-toolkit`\n    - Review the Helm Chart for the Application\n\n1. Register the Application in ArgoCD to deploy using GitOps\n    - Select ArgoCD from the Console Link and login using OpenShift login\n    - Click **NEW APP**\n    - Application Name: ${TOOLKIT_PROJECT}-qa-websphere-liberty (ie project1-qa-websphere-liberty)\n    - ArgoCD Project: `default`\n    - Sync Policy: `Automatic` (Check prune resources and self heal)\n    - Repository URL: `http://gogs.tools:3000/toolkit/gitops.git`\n    - Revision: `HEAD`\n    - Path: `qa/${TOOLKIT_PROJECT}/appmod-liberty-toolkit` (ie project1/qa/project1/appmod-liberty-toolkit)\n    - Cluster: `in-cluster`\n    - Namespace: `${TOOLKIT_PROJECT}-qa` (ie. project1-qa)\n    - Click **CREATE**\n\n1. Review the Applications in ArgoCD\n    - Filter by Namespace `${TOOLKIT_PROJECT}-qa` (ie project1-qa)\n    - Review Application: `${TOOLKIT_PROJECT}-websphere-liberty` (ie project1-websphere-liberty)\n\n1. Review the Application in OpenShift\n    - Switch to Developer perspective\n    - Select **Topology** from the menu\n    - Switch to project `${TOOLKIT_PROJECT}-qa` (ie project1-qa)\n    - Click on the route url from the `appmod-liberty-toolkit` deployment, or the link on the circle.\n    - Add `/CustomerOrderServicesWeb` to the end of the URL in the browser to access the application\n    - Log in to the application with username: `rbarcia` and password: `bl0wfish`\n\n1. Now the Websphere application is ready, the development teams can make changes to git repository for the application, while the gitops git repository is owned by the operations team.\n\n1. Congratulations you finished this activity, continue with another lab in the workshop\n","type":"Mdx","contentDigest":"11bb5bd3b3397a3f8bf7bd19a2339745","counter":1059,"owner":"gatsby-plugin-mdx"},"frontmatter":{"title":"Workshop - Application Modernization DevOps, Monolith to Container"},"exports":{},"rawBody":"---\ntitle: Workshop - Application Modernization DevOps, Monolith to Container\n---\n\nimport Globals from 'gatsby-theme-carbon/src/templates/Globals';\n\n<PageDescription>\n\n<iframe width=\"560\" height=\"315\" src=\"https://www.youtube.com/embed/ss9joPm2M1U\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen></iframe>\n\n\n- Application Modernization DevOps, Monolith to Container.\n- The following steps will deploy the modernized Customer Order Services application in a WebSphere Liberty container to a Red Hat OpenShift cluster.\n- The DevOps process is composed of Continous Integration (CI) with OpenShift Pipelines (Tekton) and Continous Deployment (CD) with GitOps engine ArgoCD\n\n</PageDescription>\n\n1. Prerequisites\n    - The instructor should [Setup Workshop Environment](/workshop/setup)\n    - The student should [Setup CLI and Terminal Shell](/workshop/setup#4.-(optional)-auto-configure-terminal-shell)\n    - An user with cluster-admin (ie kubeadmin) needs to deploy a DB2 instance to be shared by all the users\n    ```bash\n    oc new-project db2\n    oc create -n db2 serviceaccount mysvcacct\n    oc adm policy add-scc-to-user privileged system:serviceaccount:db2:mysvcacct\n    oc apply -n db2 -f \"http://$(oc get route -n tools gogs --template='{{.spec.host}}')/toolkit/appmod-liberty-toolkit/raw/master/db2/db2-dc.yaml\"\n    oc apply -n db2 -f \"http://$(oc get route -n tools gogs --template='{{.spec.host}}')/toolkit/appmod-liberty-toolkit/raw/master/db2/db2-service.yaml\"\n    ```\n\n1. (Optional) Analyze the application using the following guide [Modernizing runtimes with Liberty](https://ibm-cloud-architecture.github.io/modernization-playbook/applications/liberty/liberty-analyze)\n    - Download [Transformation Advisor](https://www.ibm.com/garage/method/practices/learn/ibm-transformation-advisor/)\n    - The results of a Data Collector is already provided provided download <a href=\"/AppSrv01.zip\" target=\"_blank\">AppSrv01.zip</a>\n    - Upload the data collection into Transformation Advisor\n    - Review the CustomerOrderServicesApp.ear analysis\n    - The migration path files have been deployed to git for this lab.\n\n1. Instructor will provide the following info:\n    - OpenShift Console URL (OCP_CONSOLE_URL)\n    - The username and password for OpenShift and Git Server (default values are user1, user2, etc.. for users and `password` for password).\n\n1. Set `TOOLKIT_USERNAME` environment variable replace `user1` with assigned usernames\n    ```bash\n    TOOLKIT_USERNAME=user1\n    ```\n1. **(Skip if using KubeAdmin or IBM Cloud)** Login into OpenShift using `oc`\n    - If you are using an IBM Cloud cluster login with your IBM account email and IAM API Key or Token, if using a cluster that was configured with the workshop scripts outside IBM Cloud then use `user1` or respective assigned username, and the password is `password`\n    ```bash\n    oc login $OCP_URL -u $TOOLKIT_USERNAME -p password\n    ```\n\n1. Set `TOOLKIT_PROJECT` environment variable replace `project1` or `projectx` based on user id assigned\n    ```bash\n    TOOLKIT_PROJECT=project1\n    ```\n\n1. Create a project/namespace using your project prefix, and `-dev` and suffix\n    ```bash\n    oc sync $TOOLKIT_PROJECT-dev\n    ```\n\n1. Fork Inventory Sample Application Java\n    - Open Developer Dashboard from the OpenShift Console\n    - Select Starter Kits\n    - Select **Liberty AppMod** (Java)\n    - Click Fork\n    - Login into GIT Sever using the provided username and password (ie `user1` and `password`)\n    - Click **Fork Repository**\n\n1. Setup environment variable `GIT_URL` for the git url using the value from previous step or as following\n    ```bash\n    GIT_REPO=appmod-liberty-toolkit\n    GIT_URL=http://${TOOLKIT_USERNAME}:password@$(oc get route -n tools gogs --template='{{.spec.host}}')/${TOOLKIT_USERNAME}/${GIT_REPO}\n    echo GIT_URL=${GIT_URL}\n    ```\n\n1. Create a pipeline for the application\n    ```bash\n    oc pipeline --tekton \\\n    ${GIT_URL}#master \\\n    --pipeline ibm-appmod-liberty \\\n    -p scan-image=false \\\n    -p health-endpoint=/ \\\n    -p java-bin-path=CustomerOrderServicesApp/target\n    ```\n    - Notice above that the Toolkit `pipeline` CLI plugin accepts pipeline names and parameters\n    - The endpoint to check that the external access is possible is `/`\n    - The Java bin path is not located based on the root of the git repository and instead in `CustomerOrderServicesApp/target`\n    - Every application would have custom values you can pass them to the pipeline as parameters.\n\n1. Verity that the Pipeline started using the URL printed by the command\n\n1. This is a good moment to take a break as the pipelines will take a few minutes.\n\n1. Verify that Pipeline Run completed successfully\n\n1. Review the Pipeline Tasks/Stages\n    - Test\n    - Open SonarQube from Console Link\n    - Open Registry from Console Link\n    - Open Artifactory from Console Link\n\n1. Review the Application in GitOps git reposistory. The pipeline step `gitops` is pushing the application manifest into the GitOps git repository\n    - Open **Git Ops** from Console link\n    - Navigate to `project1/qa/project1/appmod-liberty-toolkit`\n    - Review the Helm Chart for the Application\n\n1. Register the Application in ArgoCD to deploy using GitOps\n    - Select ArgoCD from the Console Link and login using OpenShift login\n    - Click **NEW APP**\n    - Application Name: ${TOOLKIT_PROJECT}-qa-websphere-liberty (ie project1-qa-websphere-liberty)\n    - ArgoCD Project: `default`\n    - Sync Policy: `Automatic` (Check prune resources and self heal)\n    - Repository URL: `http://gogs.tools:3000/toolkit/gitops.git`\n    - Revision: `HEAD`\n    - Path: `qa/${TOOLKIT_PROJECT}/appmod-liberty-toolkit` (ie project1/qa/project1/appmod-liberty-toolkit)\n    - Cluster: `in-cluster`\n    - Namespace: `${TOOLKIT_PROJECT}-qa` (ie. project1-qa)\n    - Click **CREATE**\n\n1. Review the Applications in ArgoCD\n    - Filter by Namespace `${TOOLKIT_PROJECT}-qa` (ie project1-qa)\n    - Review Application: `${TOOLKIT_PROJECT}-websphere-liberty` (ie project1-websphere-liberty)\n\n1. Review the Application in OpenShift\n    - Switch to Developer perspective\n    - Select **Topology** from the menu\n    - Switch to project `${TOOLKIT_PROJECT}-qa` (ie project1-qa)\n    - Click on the route url from the `appmod-liberty-toolkit` deployment, or the link on the circle.\n    - Add `/CustomerOrderServicesWeb` to the end of the URL in the browser to access the application\n    - Log in to the application with username: `rbarcia` and password: `bl0wfish`\n\n1. Now the Websphere application is ready, the development teams can make changes to git repository for the application, while the gitops git repository is owned by the operations team.\n\n1. Congratulations you finished this activity, continue with another lab in the workshop\n","fileAbsolutePath":"/home/runner/work/ibm-garage-developer-guide/ibm-garage-developer-guide/src/pages/workshop/appmod/index.mdx"}}},"staticQueryHashes":["1054721580","1054721580","1364590287","2102389209","2102389209","2456312558","2746626797","2746626797","3037994772","3037994772","3273249464","530240012","530240012","768070550"]}